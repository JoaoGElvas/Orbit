<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Orbit - Painel de Controle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400&family=Orbitron:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style-simple.css" />
  </head>
  <body class="dashboard">
    <!-- Fundo espacial animado -->
    <div id="space-background">
      <div class="stars"></div>
      <div class="nebula"></div>
      <div class="planets"></div>
    </div>

    <!-- Header da aplicação -->
    <header class="main-header">
      <div class="header-left">
        <h1 class="orbit-logo">
          <span class="orbit-text">ORBIT</span>
          <span class="orbit-subtitle">Painel de Controle</span>
        </h1>
      </div>

      <div class="header-center">
        <div class="commander-info">
          <span id="commander-name">Comandante</span>
          <div class="commander-stats">
            <span class="stat">
              <span class="stat-label">Pontos de Foco:</span>
              <span id="focus-points" class="stat-value">0</span>
            </span>
            <span class="stat">
              <span class="stat-label">Sequência:</span>
              <span id="current-streak" class="stat-value">0</span>
            </span>
          </div>
        </div>
      </div>

      <div class="header-right">
        <button id="logout-btn" class="btn btn-secondary">
          <span>DESCONECTAR</span>
        </button>
      </div>
    </header>

    <!-- Layout principal -->
    <main class="main-content">
      <!-- Sidebar esquerda - Timer Pomodoro -->
      <aside class="left-panel">
        <div class="panel-section">
          <h3 class="panel-title">TIMER DE HIPERESPAÇO</h3>
          <div class="pomodoro-timer">
            <div class="timer-display">
              <span id="timer-minutes">25</span>:<span id="timer-seconds"
                >00</span
              >
            </div>
            <div class="timer-controls">
              <button id="timer-start" class="btn btn-success">INICIAR</button>
              <button
                id="timer-pause"
                class="btn btn-warning"
                style="display: none"
              >
                PAUSAR
              </button>
              <button id="timer-reset" class="btn btn-secondary">
                RESETAR
              </button>
            </div>
            <div class="timer-status">
              <span id="timer-status-text">Pronto para foco</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- Área central - Tarefas -->
      <section class="center-panel">
        <!-- Abas de navegação -->
        <div class="mission-tabs">
          <button class="tab-btn active" data-tab="daily">
            MISSÕES DIÁRIAS
          </button>
          <button class="tab-btn" data-tab="weekly">DIRETIVAS SEMANAIS</button>
          <button class="tab-btn" data-tab="history">DIÁRIO DE BORDO</button>
        </div>

        <!-- Área de tarefas diárias -->
        <div id="daily-tasks" class="tasks-container active">
          <div class="task-input-area">
            <div class="input-group">
              <input
                type="text"
                id="daily-task-input"
                placeholder="Nova missão diária..."
              />
              <select id="daily-priority-select">
                <option value="normal">Prioridade Normal</option>
                <option value="low">Prioridade Baixa</option>
                <option value="critical">Prioridade Crítica</option>
              </select>
              <button id="add-daily-task" class="btn btn-primary">
                ADICIONAR
              </button>
            </div>
            <textarea
              id="daily-task-description"
              placeholder="Descrição da missão (opcional)..."
              rows="2"
            ></textarea>
          </div>
          <div id="daily-tasks-list" class="tasks-list"></div>
        </div>

        <!-- Área de tarefas semanais -->
        <div id="weekly-tasks" class="tasks-container">
          <div class="task-input-area">
            <div class="input-group">
              <input
                type="text"
                id="weekly-task-input"
                placeholder="Nova diretiva semanal..."
              />
              <select id="weekly-priority-select">
                <option value="normal">Prioridade Normal</option>
                <option value="low">Prioridade Baixa</option>
                <option value="critical">Prioridade Crítica</option>
              </select>
              <button id="add-weekly-task" class="btn btn-primary">
                ADICIONAR
              </button>
            </div>
            <textarea
              id="weekly-task-description"
              placeholder="Descrição da diretiva (opcional)..."
              rows="2"
            ></textarea>
          </div>
          <div id="weekly-tasks-list" class="tasks-list"></div>
        </div>

        <!-- Histórico de tarefas -->
        <div id="history-tasks" class="tasks-container">
          <div class="history-header">
            <h3>Missões Concluídas</h3>
            <p>Histórico de suas conquistas espaciais</p>
          </div>
          <div id="history-tasks-list" class="tasks-list history-list"></div>
        </div>
      </section>

      <!-- Sidebar direita - Estatísticas -->
      <aside class="right-panel">
        <div class="panel-section">
          <h3 class="panel-title">STATUS DA MISSÃO</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <span class="stat-label">Pontos de Foco</span>
              <span id="total-focus-points" class="stat-number">0</span>
            </div>
            <div class="stat-card">
              <span class="stat-label">Sequência Atual</span>
              <span id="streak-current" class="stat-number">0</span>
            </div>
            <div class="stat-card">
              <span class="stat-label">Melhor Sequência</span>
              <span id="streak-best" class="stat-number">0</span>
            </div>
            <div class="stat-card">
              <span class="stat-label">Total Completado</span>
              <span id="total-completed" class="stat-number">0</span>
            </div>
          </div>
        </div>

        <div class="panel-section">
          <h3 class="panel-title">SISTEMAS</h3>
          <div class="system-indicators">
            <div class="indicator">
              <span class="indicator-dot active"></span>
              <span>Motor Principal</span>
            </div>
            <div class="indicator">
              <span class="indicator-dot active"></span>
              <span>Suporte Vital</span>
            </div>
            <div class="indicator">
              <span class="indicator-dot active"></span>
              <span>Comunicações</span>
            </div>
            <div class="indicator">
              <span class="indicator-dot active"></span>
              <span>Navegação</span>
            </div>
          </div>
        </div>
      </aside>
    </main>

    <!-- Modal para editar tarefas -->
    <div id="edit-task-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>EDITAR MISSÃO</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="input-group">
            <label for="edit-task-title">Título da Missão</label>
            <input type="text" id="edit-task-title" />
          </div>
          <div class="input-group">
            <label for="edit-task-description">Descrição</label>
            <textarea id="edit-task-description" rows="3"></textarea>
          </div>
          <div class="input-group">
            <label for="edit-task-priority">Prioridade</label>
            <select id="edit-task-priority">
              <option value="low">Baixa</option>
              <option value="normal">Normal</option>
              <option value="critical">Crítica</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button id="save-task-edit" class="btn btn-primary">SALVAR</button>
          <button id="cancel-task-edit" class="btn btn-secondary">
            CANCELAR
          </button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script src="js/timer.js"></script>
    <script src="js/app.js"></script>
    <script>
      // Verificar autenticação antes de carregar a página
      document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("orbit_token");
        if (!token) {
          window.location.href = "/login";
          return;
        }

        // Verificar se o token é válido
        fetch("/api/auth/verify", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (!data.valid) {
              localStorage.removeItem("orbit_token");
              localStorage.removeItem("orbit_user");
              window.location.href = "/login";
            } else {
              // Inicializar aplicação apenas se autenticado
              window.authManager = new AuthManager();
              window.orbitApp = new OrbitApp();
            }
          })
          .catch(() => {
            localStorage.removeItem("orbit_token");
            localStorage.removeItem("orbit_user");
            window.location.href = "/login";
          });
      });
    </script>
  </body>
</html>
